"use strict";function initGlobalListener(){if(config.listener.$onLaunch.state){var e={};if(wx.getLaunchOptionsSync){var t=wx.getLaunchOptionsSync();e=Object.assign(t,config.listener.$onLaunch.data)}py("event",event.appLauch,e)}config.listener.$onAppShow.state&&wx.onAppShow(function(e){log("show"),log(e),clearRecord();var t=Object.assign(e,config.listener.$onAppShow.data);py("event",event.appShow,t)}),config.listener.$onAppHide.state&&wx.onAppHide(function(e){log("hide"),log(e);var t=Object.assign(e,config.listener.$onAppHide.data);py("event",event.appHide,t)}),config.listener.$onPage.state&&wx.onAppRoute(function(e){log("page"),log(e),setRecord(e);var t=Object.assign(e,config.listener.$onPage.data);py("event",event.appPage,t)})}function initGlobalParam(){var e=getApp();e.globalData[config.name]=py,log(e)}function clearRecord(){config.historys=[],config.url="",config.reffer=""}function setRecord(e){var t=joinUrl(e.path,e.query),n=e.query,o=n.pyuuid,r=n.pyck,i=n.mpyck;config.url=t,config.pyuuid=o,config.pyck=r,config.mpyck=i,config.historys.length>0&&(config.reffer=config.historys[config.historys.length-1].url);var a=e;a.url=t,config.historys.push(a)}function joinUrl(e,t){var n=[];return Object.keys(t).forEach(function(e){n.push(e+"="+t[e])}),n.length>0?e+"?"+n.join("&"):e}function request(e,t){wx.request({url:e,data:t})}function getUUID(){return"py"+(S4()+S4())+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},config={name:"py",domain:"stats.ipinyou.com",uuid:getUUID(),openid:"",unionid:"",a:"",dev:!1,listener:{$onAppShow:{state:!0,data:{}},$onAppHide:{state:!0,data:{}},$onLaunch:{state:!0,data:{}},$onPage:{state:!0,data:{}}},url:"",reffer:"",pyuuid:"",pyck:"",mpyck:"",historys:[],userInfo:{}},event={appShow:"appShow",appHide:"appHide",appLauch:"appLauch",appPage:"appPage"};exports.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.a;log(wx),t?config.a=t:error("需要指定广告主ID"),setTimeout(function(){initGlobalListener(),initGlobalParam()},0)},exports.setConfig=function(e){config.name=e.name||"py",config.a=e.a||config.a,config.domain=e.domain||config.domain,config.listener.$onAppShow.state=e.$onAppShow||!0,config.listener.$onAppHide.state=e.$onAppHide||!0,config.listener.$onLaunch.state=e.$onLaunch||!0,config.listener.$onPage.state=e.$onPage||!0},exports.setOpenid=function(e){config.openid=e,py("event","openId")},exports.setUnionid=function(e){config.unionid=e,py("event","unionId")},exports.appendAppLaunchData=function(e){config.listener.$onLaunch.data=Object.assign(config.listener.$onLaunch.data,e)},exports.appendAppShowData=function(e){config.listener.$onAppShow.data=Object.assign(config.listener.$onAppShow.data,e)},exports.appendAppHideData=function(e){config.listener.$onAppHide.data=Object.assign(config.listener.$onAppHide.data,e)},exports.appendAppPageData=function(e){config.listener.$onPage.data=Object.assign(config.listener.$onPage.data,e)},exports.setUserInfo=function(e){config.userInfo=e},exports.appendUserInfo=function(e){config.userInfo=Object.assign(config.userInfo,e)};var py=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];execute(t)},objTypeArg=/\[object (Boolean|Number|String|Function|Array|Date|RegExp)\]/,objTypeString=function(e){if(null==e)return String(e);var t=objTypeArg.exec(Object.prototype.toString.call(Object(e)));return t?t[1].toLowerCase():"object"},isObject=function(e){return"object"===objTypeString(e)&&!isEmptyObject(e)},isEmptyObject=function(e){var t=void 0;for(t in e)return!1;return!0},log=function(e){config.dev&&console&&console.log&&console.log(e)},warn=function(e){config.dev&&console&&console.warn&&console.warn(e)},error=function(e){config.dev&&console&&console.error&&console.error(e)},_prop=function(e,t,n){this.name=e,this.shortName=t,this.required=n},_object=function(){this.keys=[],this.props={},this.values={}};_object.prototype.addProp=function(e,t){this.keys.push(e),this.props[":"+e]=new _prop(e,t)},_object.prototype.hasKey=function(e){for(var t=0;t<this.keys.length;t++)if(e==this.keys[t])return!0;return!1},_object.prototype.set=function(e,t){if(this.hasKey(e)){var n=this.get(e);isObject(t)?this.values[":"+e]=extend(n,t):this.values[":"+e]=t}else this.addProp(e,e),this.values[":"+e]=t},_object.prototype.get=function(e){return this.values[":"+e]},_object.prototype.merge=function(e){var t=this;Object.keys(e).forEach(function(n){t.set(n,e[n])})},_object.prototype.clear=function(e){this.values={}},_object.prototype.toObject=function(){for(var e={},t=0;t<this.keys.length;t++){var n=this.keys[t],o=this.get(n),r=this.props[":"+n].shortName;void 0!=o&&(e[r]=o)}return e};var _eventObject=function(e,t){this.prop=new _prop(e,t),this.obj=new _object};_eventObject.prototype.addProps=function(e){for(var t=0;t<e.length;t++){var n=e[t];this.obj.addProp(n[0],n[1])}return this},_eventObject.prototype.addProp=function(e,t,n){return this.obj.addProp(e,t,n),this},_eventObject.prototype.get=function(e){return this.obj.get(e)};var browserInfo={},eventInfo={};eventInfo.domain=new _eventObject("domain","d").addProps([["domain","d"]]),eventInfo.mapping=new _eventObject("mapping","mp").addProps([["mapping","mp"]]),eventInfo.default=new _eventObject("default","df").addProps([["events","evs"]]),eventInfo.extend=new _eventObject("extend","e").addProps([["extend","e"]]),eventInfo.user=new _eventObject("user","ur").addProps([["id","i",!0],["name","n"],["cookieId","ci"],["email","em"],["type","t"],["category","ca"]]),eventInfo.clickParam=new _eventObject("clickParam","cp").addProps([["clickParam","cp"]]),eventInfo.site=new _eventObject("site","st").addProps([["type","t"],["id","i"],["industry","ind"]]),eventInfo.viewHome=new _eventObject("viewHome","vh"),eventInfo.viewList=new _eventObject("viewList","vl").addProps([["categoryPath","cp",!0]]),eventInfo.viewItem=new _eventObject("viewItem","vi").addProps([["area","aa"],["android_brand_schema","abs"],["activity_content","ac"],["activity_end_time","ae"],["airplane_model","am"],["addr","ar"],["activity_start_time","as"],["android_shop_schema","ass"],["android_schema_url","asu"],["start_area","str"],["start_time","stt"],["activity_url","au"],["brand","b"],["business_area","ba"],["brand_id","bi"],["brand_logo","bl"],["brand_url","bu"],["category","ca",!0],["currency_code","cc",!0],["classify","cf"],["category_id","cid"],["category_path","cp"],["city","cty"],["country","cy"],["discount","dc"],["decoration","de"],["duration","du"],["extend","e"],["end_airport","ea"],["end_area","er"],["end_time","et"],["feature","ft"],["house_area","ha"],["house_mode","hd"],["has_meals","hm"],["house_type","ht"],["ios_brand_schema","ibs"],["ios_shop_schema","iss"],["ios_schema_url","isu"],["lbs","lb"],["mobile_activity_url","ma"],["mobile_brand_logo","mbl"],["mobile_brand_url","mbu"],["mobile_pic_height","mh"],["mobile_pic_ratio","mm"],["mobile_pc_pic_url","mpu"],["mobile_shop_logo","msl"],["mobile_shop_url","msu"],["mobile_pic_url","mu"],["mobile_pic_width","mw"],["name","n"],["off_time","oft"],["orig_price","op"],["on_time","ot"],["pic_height","ph"],["punctuality_ratio","pl"],["promotion","pm"],["product_no","pn"],["pc_pic_url","ppu"],["price","pr",!0],["pic_ratio","pt"],["product_url","pu",!0],["pic_width","pw"],["removed","rm"],["short_desc","sd"],["score","se"],["spu_id","si"],["shop_logo","sl"],["short_name","sm"],["shop_name","sn"],["sold_out","so"],["shop_id","sp"],["start_airport","sta"],["shop_url","su"],["star_level","sv"],["seat_type","sy"],["total_price","tl"],["type","t"],["mobile_product_url","wap"],["mobile_pic_size","ms"],["pic_size","pis"]]),eventInfo.viewSearch=new _eventObject("viewSearch","vs").addProps([["keywords","k",!0]]),eventInfo.viewActivity=new _eventObject("viewActivity","va").addProps([["name","n"]]),eventInfo.viewChannel=new _eventObject("viewChannel","vn").addProps([["name","n"]]),eventInfo.viewUserIndex=new _eventObject("viewUserIndex","vu").addProps([["userId","ui"]]),eventInfo.viewCart=new _eventObject("viewCart","vc").addProps([["money","m"],["id","i"],["count","ct"],["price","pr"]]),eventInfo.viewPage=new _eventObject("viewPage","vg").addProps([["page","pg"]]),eventInfo.collect=new _eventObject("collect","cl").addProps([["id","i"],["trackId","ti"]]),eventInfo.order=new _eventObject("order","od").addProps([["id","i"],["money","m"],["items","it"],["count","ct"],["price","pr"],["trackId","ti"]]),eventInfo.addCart=new _eventObject("addCart","ad").addProps([["id","i"],["trackId","ti"]]),eventInfo.register=new _eventObject("register","rg").addProps([["id","i"],["name","n"],["email","em"],["type","t"],["data","d"],["trackId","ti"]]),eventInfo.leads=new _eventObject("leads","ls").addProps([["id","i"],["name","n"],["email","em"],["type","t"],["data","d"],["trackId","ti"]]),eventInfo.custom=new _eventObject("custom","cm").addProps([["id","i"],["customEvent","ce"],["data","d"],["trackId","ti"]]),eventInfo.consult=new _eventObject("consult","co").addProps([["trackId","ti"]]),eventInfo.message=new _eventObject("message","msg").addProps([["trackId","ti"]]),eventInfo.purchase=new _eventObject("purchase","pch").addProps([["id","i"],["money","m"],["items","it"],["count","ct"],["price","pr"],["trackId","ti"]]),eventInfo.statistics=new _eventObject("statistics","sts").addProps([["trackId","ti"]]),eventInfo.standingTime=new _eventObject("standingTime","ste"),eventInfo.scrollEvent=new _eventObject("scrollEvent","se"),eventInfo.appShow=new _eventObject("appShow","as").addProps([["path","path"]]),eventInfo.appHide=new _eventObject("appHide","ah").addProps([["path","path"]]),eventInfo.appLauch=new _eventObject("appLauch","al").addProps([["path","path"]]),eventInfo.appPage=new _eventObject("appPage","ap").addProps([["path","path"]]),eventInfo.openId=new _eventObject("openId","oi").addProps([["path","path"]]),eventInfo.unionId=new _eventObject("unionId","uni").addProps([["path","path"]]);var josEncode=function(){function e(e){void 0==e&&(e="");var t=void 0===e?"undefined":_typeof(e);switch(t){case"boolean":return n(e);case"string":return i(e);case"number":return o(e);case"object":return a(e);case"array":return c(e);default:throw"Unsupported type '"+t+"'"}}function t(e){for(var t=s.charAt(31&e),n=e>>>5;0!=n;)t=s.charAt(31&n|32)+t,n>>>=5;return t}function n(e){return e?s.charAt(1):s.charAt(2)}function o(e){if(Number.isFinite&&!Number.isFinite(e)||isNaN&&isNaN(e)||e==1/0||e==-1/0)throw"Unsupported Number: Infinity,-Infinity,NaN";var n=e.toString();return s.charAt(3)+t(n.length)+n.replace(/\+/g,"P").replace(/\./g,"D")}function r(e){switch(e){case 26:return 32;case 27:return 45;case 28:return 46;case 29:return 47;case 30:return 58;case 31:return 95;case 32:return 26;case 45:return 27;case 46:return 28;case 47:return 29;case 58:return 30;case 95:return 31;default:return e>=97&&e<=122?e-97:e>=0&&e<=25?e+97:e}}function i(e){for(var n=!0,o=0;o<e.length;o++){var i=e.charCodeAt(o);if(!(i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||95==i||46==i)){n=!1;break}}if(n)return s.charAt(4)+t(e.length)+e.replace(/\./g,"-");for(var a=s.charAt(5)+t(e.length),c=0;c<e.length;c++)a+=t(r(e.charCodeAt(c)));return a}function a(n){if(null==n)return s.charAt(0);if(Array.isArray&&Array.isArray(n)||"[object Array]"==Object.prototype.toString.call(n))return c(n);var o=[];for(var r in n)n.hasOwnProperty(r)&&(o[o.length]=r);var a=s.charAt(6)+t(o.length);for(var p in o)a+=i(o[p])+e(n[o[p]]);return a}function c(n){var o=s.charAt(7)+t(n.length);for(var r in n)o+=e(n[r]);return o}var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz_";return e}(),execute=function(e){try{if(e&&e.length<2)return;var t=e[0];if("set"!=t&&"event"!=t)return void log("目前不支持此命令:"+t);var n=e[1],o=eventInfo[n].obj,r=o.keys,i="adv",a=void 0;"event"==t&&o.clear();for(var c=2;c<e.length;c++){var s=e[c];if(c==e.length-1&&isObject(s))s.trackId&&(e.t=s.trackId,delete s.trackId),o.merge(s);else{if("trackId"==r[c-2]&&""!=s){e.t=s;continue}r.length>c-2?o.set(r[c-2],s):error("参数错误")}}if("event"==t){e.t&&""!=(a="array"==objTypeString(e.t)&&e.t.length>0&&e.t[0].length>0?e.t[0][0]:"string"==objTypeString(e.t)?e.t:"")&&(i="cvt");var p=eventInfo.domain.get("domain"),d=void 0==p?[config.domain]:isArray(p)?p:[p],u=eventInfo.extend.get("extend"),f=eventInfo.user.obj.toObject(),v=eventInfo.site.obj.toObject(),l={},g=o.toObject();l.u=config.url,l.r=config.reffer;for(var h=0;h<d.length;h++){var b="https://"+d[h]+"/"+i+"?a="+config.a+(void 0!=a&&""!=a?"&ti="+a:"")+(void 0!=config.pyuuid&&""!=config.pyuuid?"&pyuuid="+config.pyuuid:"")+(void 0!=config.pyck&&""!=config.pyck?"&c="+config.pyck:"")+(void 0!=config.mpyck&&""!=config.mpyck?"&mc="+config.mpyck:"")+"&ev="+eventInfo[n].prop.shortName+"&v=3&oi="+config.openid+"&uni="+config.unionid+"&uid="+config.uuid+(isEmptyObject(f)?"":"&"+eventInfo.user.prop.shortName+"="+josEncode(f))+(isEmptyObject(v)?"":"&"+eventInfo.site.prop.shortName+"="+josEncode(v))+(isEmptyObject(browserInfo)?"":"&b="+josEncode(browserInfo))+(isEmptyObject(l)?"":"&pg="+josEncode(l))+(isEmptyObject(g)?"":"&ep="+josEncode(g))+(void 0==u?"":"&e="+josEncode(u))+"&rd="+(new Date).getTime();log(b),request(b,{})}}}catch(e){error(e)}};